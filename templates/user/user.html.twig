{% extends 'base.html.twig' %}

{% block title %}User{% endblock %}

{% block content %}
<div class="connected-interface d-flex" style="height: 100vh;">
  <div class="submenu col-2">
    <table class="w-100">
      <tr>
        <td class="submenu-item p-3">
          <img class="menu-icon" src="{{asset('img/home.svg')}}">
          <a class="submenu-link" href="{{asset('user')}}"><span> Hub</span></a>
        </td>
      </tr>
      {% if is_granted('ROLE_ADMIN') %}
      <tr>
        <td class="submenu-item p-3">
          <img class="menu-icon" src="{{asset('img/admin.svg')}}">
          <a class="submenu-link" href="{{asset('admin')}}"><span> Administration</span></a>
        </td>
      </tr>
      {% endif %}
      <tr>
        <td class="submenu-item p-3">
          <img class="menu-icon" src="{{asset('img/account.svg')}}">
          <a class="submenu-link" href="{{path('account')}}"><span> Account</span></a>
        </td>
      </tr>
      <tr>
        <td class="submenu-item p-3">
          <img class="menu-icon" src="{{asset('img/wallet.svg')}}"> 
          <a class="submenu-link" href="{{ path('wallet') }}">
            <span> Wallet</span>
          </a>
        </td>
      </tr>
    </table>
  </div>
  <div class="right-column bg-light col-10 d-flex flex-column justify-content-start" style="overflow-y: scroll"> 
    <div class="d-flex flex-row mb-3 justify-content-between">

      <div class="bento-box" style="width: 70%; overflow-x: scroll;">
        Activity <span class="vertical-divider"></span>
        <!-- Transaction history start -->
        <div class="d-flex flex-row align-items-center" style="height: 60px;">
          {% for transaction in transactions %}

            <div class="d-flex flex-column p-2" style="width: 100px; font-size: 14px;">
              <div>
                {% if transaction.transactionType == 'sell' %}
                  <u style="fonr-size: 16px">Sold : </u></br>
                  {{ transaction.quantity }} {{ transaction.cryptocurrency.getCryptoSymbol() }}
                {% elseif transaction.transactionType == 'buy' %}
                  <u style="fonr-size: 16px">Bought : </u></br>
                  {{ transaction.quantity }} {{ transaction.cryptocurrency.getCryptoSymbol() }}
                {% endif %}
              </div>
              <div style="color: #35A7FF; font-size: 10px;">
                {{ transaction.date|date('Y-m-d') }}
                </br>
                {{ transaction.date|date('H:i:s') }}
              </div>
            </div>
            <span class="vertical-divider"></span>
          {% endfor %}
        </div>
        <!-- Transaction history end -->
      </div>

      <div class="secondary-background bento-box">
        <span class="fs-4">Balance : {{ currentUser.euros }} $</span>
      </div>
    </div>

    <hr>

    <h3 class="mb-3">Live Crypto Values</h3>

    <div class="embed-responsive embed-responsive-16by9">
      <!-- TradingView Widget BEGIN -->
      <div class="tradingview-widget-container">
        <div id="tradingview_12345"></div>
      </div>
      <!-- TradingView Widget END -->  
    </div>
  </div>
  </div>
    
  </div>
  </div>
  </div>
</div>
</div>
</div>

{% endblock %}

{% block javascripts %}
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script type="text/javascript">
  function initTradingViewWidget() {
    new TradingView.widget({
      "autosize": true,
      "symbol": "BINANCE:BTCUSDT",
      "interval": "H",
      "timezone": "Europe/Paris",
      "theme": "light",
      "style": "1",
      "locale": "fr",
      "toolbar_bg": "#f1f3f6",
      "enable_publishing": false,
      "allow_symbol_change": true,
      "container_id": "tradingview_12345"
    });
  }

  document.addEventListener('DOMContentLoaded', function () {
    if (document.getElementById('tradingview_12345')) {
      initTradingViewWidget();
    }
  });

  document.querySelectorAll('.submenu-link').forEach(function(link) {
    link.addEventListener('click', function() {
      setTimeout(function() {
        if (document.getElementById('tradingview_12345')) {
          initTradingViewWidget();
        }
      }, 500); // Adjust delay as needed
    });
  });
</script>
{% endblock %}